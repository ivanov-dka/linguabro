var subData = `1
00:00:22,235 --> 00:00:23,668
-Attention all units in the facility.

2
00:00:23,778 --> 00:00:27,706
We have a possible suspect ID at the Sunshine apartment complex at peak on Boulevard.

3
00:00:39,415 --> 00:00:40,893
All available units in the area.

4
00:00:40,842 --> 00:00:42,546
We have a positive ID on the suspect.

5
00:00:42,752 --> 00:00:45,814
Last name: Black
First name: Chris A.K.A Raven.

6
00:00:45,849 --> 00:00:48,779
Response at Sunshine apartment complex apartment 2A.

7
00:00:49,446 --> 00:00:53,006
Suspect is considered armed and extremely dangerous.
Proceed with caution.

8
00:01:03,127 --> 00:01:05,403
-Stop or I will open fire.

9
00:01:12,976 --> 00:01:18,714
Citizen, this is the Los Angeles Police Force.
Step out with your hands on your head.

10
00:01:18,841 --> 00:01:21,905
I repeat, step out with your hands on your head.

11
00:01:27,119 --> 00:01:29,711
Citizen, put your hands on your head.

12
00:01:30,648 --> 00:01:33,735
Any available units, unit 75 is now with suspect.

13
00:01:34,069 --> 00:01:36,248
South West alley in Main Street and  7.

14
00:01:37,034 --> 00:01:41,093
-Suspect is considered armed and extremely dangerous.
Proceed with caution.

15
00:01:41,906 --> 00:01:43,495
-Thank you for your co-operation.

16
00:01:46,171 --> 00:01:47,071
Have a wonderful day.

17
00:01:51,513 --> 00:01:54,065
-All units, suspect is heading north on Secora.

18
00:01:54,705 --> 00:01:58,036
All units til latitude.
33 north, longitude 119 west.

19
00:01:58,339 --> 00:02:00,123
Use of deadly force has been approached.

20
00:02:28,451 --> 00:02:29,120
-What the hell?

21
00:02:30,405 --> 00:02:31,486
Yo man what's up man?

22
00:02:32,676 --> 00:02:33,778
Scratching up my ride man.

23
00:02:36,218 --> 00:02:39,311
Yo man you're lucky I'm on parole man or I'd have to beat you down man.

24
00:02:41,333 --> 00:02:42,053
Yo what's up use?

25
00:02:42,919 --> 00:02:44,074
Yo, what I got a flat?

26
00:02:44,461 --> 00:02:46,591
-Stop or I will open fire.

27
00:02:49,365 --> 00:02:51,574
Citizen, put your hands on your head.

28
00:02:54,221 --> 00:02:55,731
This is your final warning.

29
00:03:09,648 --> 00:03:13,414
-Attention units, units 55, 75 have been by suspect.

30
00:03:14,070 --> 00:03:17,604
-Officers operating units, prepare to block all cities exits.

31
00:03:17,473 --> 00:03:22,580
Do not let suspect exit the city,
repeat do not let suspect exit the city.

32
00:03:31,661 --> 00:03:32,880
-Move you big trashcan.

33
00:03:33,698 --> 00:03:34,535
Get out of my alley.

34
00:03:38,802 --> 00:03:39,386
-Fuck.

35
00:03:39,531 --> 00:03:46,152
-Suspect, this is the Los Angeles Police Force.
Come out with your fingers interlaced on top of your head.

36
00:03:50,853 --> 00:03:51,990
-Why?

37
00:03:54,954 --> 00:03:59,950
-Suspect, step out with your fingers interlaced on top of your head.

38
00:04:00,326 --> 00:04:03,094
This is your final warning.

39
00:04:12,536 --> 00:04:15,644
Suspect, put your hands on top of your head.

40
00:04:16,554 --> 00:04:20,073
I repeat, put your hands on top of your head.

41
00:04:22,657 --> 00:04:24,723
-Be adviced, all units response code 3.


42
00:05:09,892 --> 00:05:13,579
Translated by Thomas "Supermix1337" Nilsen.

`;

var subDataRus = `1
00:00:22,235 --> 00:00:23,668
-Внимание! Всем подразделениям на объект.

2
00:00:23,778 --> 00:00:27,706
Возможно у нас есть подозрительное удостоверение личности в центре жилого комплекса на бульваре Саншай.

3
00:00:39,415 --> 00:00:40,893
-Всем свободным подразделениям в этом районе.

4
00:00:40,842 --> 00:00:42,546
У нас есть подтверждение,мы индетифицировали личности подозреваемого.

5
00:00:42,752 --> 00:00:45,814
Фамилия: Черный
Имя: Крис A.K.A Ворон.

6
00:00:45,849 --> 00:00:48,779
Местонахождение в квартире жилого комплекса Саншай 2A.

7
00:00:49,446 --> 00:00:53,006
Подозреваемого считают вооруженным и чрезвычайно опасным.
Соблюдайте осторожность.

8
00:01:03,127 --> 00:01:05,403
- Остановитесь или я открою огонь.

9
00:01:12,976 --> 00:01:18,714
Гражданин, это - полиция Лос-Анджелеса.
Выйдите, руки за голову.

10
00:01:18,841 --> 00:01:21,905
Я повторяю, выйти с поднятыми руками за головой.

11
00:01:27,119 --> 00:01:29,711
Гражданин, положите руки за голову.

12
00:01:30,648 --> 00:01:33,735
Всем доступным подразделениям, подразделение 75 в настоящее время с подозреваемым.

13
00:01:34,069 --> 00:01:36,248
Юго-западный переулок на Мэйн-Стрит 7.

14
00:01:37,034 --> 00:01:41,093
Подозреваемого считают вооруженным и чрезвычайно опасным.
Соблюдайте осторожность.

15
00:01:41,906 --> 00:01:43,495
- Спасибо за Ваше сотрудничество.

16
00:01:46,171 --> 00:01:47,071
Прекрасный день.

17
00:01:51,513 --> 00:01:54,065
-Всем подразделениям, подозреваемый движется в северном направлении на Секора.

18
00:01:54,705 --> 00:01:58,036
Всем подразделениям на
33 градуса северной широты и 119 градусов западной долготы.

19
00:01:58,339 --> 00:02:00,123
Он использует смертельную силу, приближаюсь.

20
00:02:28,451 --> 00:02:29,120
Какого черта?

21
00:02:30,405 --> 00:02:31,486
Эй парень, кто ты такой?

22
00:02:32,676 --> 00:02:33,778
Царапины на моей машине.

23
00:02:36,218 --> 00:02:39,311
Эй парень, тебе повезло, что я - человек освобожденный под честное слово, а то бы я избил тебя.

24
00:02:41,333 --> 00:02:42,053
Эй, что ты делаешь?

25
00:02:42,919 --> 00:02:44,074
Эй, что я получу взамен?

26
00:02:44,461 --> 00:02:46,591
- Остановитесь или я открою огонь.

27
00:02:49,365 --> 00:02:51,574
Гражданин, положите руки за голову.

28
00:02:54,221 --> 00:02:55,731
Это мое последнее предупреждение.

29
00:03:09,648 --> 00:03:13,414
- Внимание подразделениям, подразделения 55, 75 были ликвидированны подозреваемым.

30
00:03:14,070 --> 00:03:17,604
-Сотрудники оперативных подразделений, заблокируйте все выходы из города.

31
00:03:17,473 --> 00:03:22,580
Не позволяйте подозреваемому скрыться из города,
повторяю не позволяйте подозреваемому скрыться из города.

32
00:03:31,661 --> 00:03:32,880
-Ты двигающийся большой робот.

33
00:03:33,698 --> 00:03:34,535
Выйдите из моего переулка.

34
00:03:38,802 --> 00:03:39,386
-Черт возьми.

35
00:03:39,531 --> 00:03:46,152
- Подозреваемый, это - полиция Лос-Анджелеса.
Скрепите пальцы за головой.

36
00:03:50,853 --> 00:03:51,990
-За что?

37
00:03:54,954 --> 00:03:59,950
- Подозревайте, выйдите со скрепленными пальцами за головой.

38
00:04:00,326 --> 00:04:03,094
Это моё последнее предупреждение.

39
00:04:12,536 --> 00:04:15,644
Подозреваемый, положите руки за голову.

40
00:04:16,554 --> 00:04:20,073
Я повторяю, положите руки за голову.

41
00:04:22,657 --> 00:04:24,723
-Имейте в виду, всем подразделения код ответа 3.
`;

var isRus = false;

var subText;
//на инициализации создаем массив объектов субтитров в глобальной переменной
function initSubCreation() {

    var test = $.ajax({
        type: "GET",
        url: "https://linguabro.blob.core.windows.net/test/The%20Raven.2010.HDRip-AVC%20(720).eng.txt",
        cache: false,
        async: false
    }).responseText;
    if (test) {
        subData = parseSRT(test);
    }
    else {
        subData = parseSRT(subData);
    }

    var test2 = $.ajax({
        type: "GET",
        url: "https://linguabro.blob.core.windows.net/test/rus.txt",
        cache: false,
        async: false
    }).responseText;
    if (test2) {
        subDataRus = parseSRT(test2);
    }
    else {
        subDataRus = parseSRT(subDataRus);
    }
    
    var video = $('video').get(0);
    if (video) {
        video.onwebkitfullscreenchange = function () {
            $('#subs span').popover('hide');
            $('#subs span').removeClass('word_selected');
            if (video.webkitDisplayingFullscreen) {
                $("#subs").css('width', window.innerWidth)
                $("#subs").removeClass('smallFont');
                $("#subs").addClass('largeFont');

            }
            else {
                $("#subs").css('width', video.width)
                $("#subs").addClass('smallFont');
                $("#subs").removeClass('largeFont');
            }
        }
    }
}

//выбираем саб для видео
function setSubSelected(second) {

    $('#subsList li.selected').removeClass('selected');
    $('#subsList li').each(function () {

        second = parseFloat(second);
        var start = parseFloat($(this).attr('data-start'));
        var end = parseFloat($(this).attr('data-end'));
        if (start <= second && second <= end) {
            $(this).addClass('selected');
            console.log($(this).text());
            console.log('top: ' + $(this).offset().top);
            console.log('scrollTop: ' + $('.inner')[0].scrollTop);

            $('.inner').animate({
                scrollTop: $(this).offset().top + $('.inner')[0].scrollTop - 100
            }, 200);
            
            return true;
        }

    });
}

//создаем список сабов
function createSubList() {
    var subsList = "";

    var data = isRus ? subDataRus : subData;

    if ($('#subsList li').length == 0) {

        for (var i = 0; i < data.length; i++) {
            var subText = data[i].text.replace(/<br\/>/g, ' ').replace(/<br>/g, ' ').match(/[^ ]+/g)
            subsList += '<li id="' + data[i].id + '" data-start="' + data[i].start + '" data-end="' + data[i].end + '">'
            for (var j = 0; j < subText.length; j++) {
                subsList += '<a href="#" >' + ' ' + subText[j] + ' ' + '</a>';
            }
            subsList += '</li>'
        }

        $('#subsList').append(subsList);

        setScroll();
    }
    else {
        $('#subsList li').empty();
        for (var i = 0; i < data.length; i++) {
            var subText = data[i].text.replace(/<br\/>/g, ' ').replace(/<br>/g, ' ').match(/[^ ]+/g)
            
            var li = $('li[id="' + data[i].id + '"]');
            for (var j = 0; j < subText.length; j++) {
                var sub = '<a href="#" >' + ' ' + subText[j] + ' ' + '</a>';
                li.append(sub);
            }            
        }

        setScroll();
    }
}

// подставляем субтитры под текущий timestamp
function createSub(second) {
    video = $('video').get(0);
    //if (video.paused) return;
    var data = isRus ? subDataRus : subData;

    for (var i = 0; i < data.length; i++) {
        //если текущий timestamp находится в промежутке timestamp объекта субтитров, берем текст и объекта
        if (second < data[i].end && second > data[i].start) {
            var subText = data[i].text.match(/[^ ]+/g)
            //очищаем текущий контейнер субтитров
            $('#subs').html('');
            //заполняем его набором субтитров
            for (var j = 0; j < subText.length; j++) {
                $('#subs').append('<span>' + ' ' + subText[j] + ' ' + '</span>')
            }
            $('#subs span').click(function () {
                if ($(this).hasClass('word_selected')) return;
                $(".word_selected").removeAttr('title')
                $(".word_selected").removeAttr('data-original-title')
                $('#subs span').removeClass('word_selected');
                $('#subs span').popover('hide');
                video.pause();
                $(this).addClass('word_selected')
                showTranslatedWorldInVideoSub($(this).text(), $(this));
            });
            return;
        }
    }
    // если текущий timestamp не находится ни в одном из промежутков значит субтитров быть не должно
    $('#subs').html('');
}

